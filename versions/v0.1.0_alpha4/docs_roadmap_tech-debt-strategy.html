
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Debt Strategy - OpenTrusty Docs</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // Adjust paths based on whether we are in a versioned directory or root
        const isRoot = window.location.pathname === '/' || window.location.pathname === '/index.html';
        const basePath = isRoot ? '' : '.'; 
    </script>
    <style>
        :root {
            --primary: #4A90E2;
            --bg: #0f172a;
            --sidebar-bg: rgba(30, 41, 59, 0.7);
            --text: #f8fafc;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            min-height: 100vh;
        }
        /* Glassmorphism Sidebar */
        .sidebar {
            width: 300px;
            background: var(--sidebar-bg);
            backdrop-filter: blur(12px);
            border-right: 1px solid var(--border);
            padding: 2rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        .logo {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary);
            text-decoration: none;
        }
        .nav-section { margin-bottom: 1.5rem; }
        .nav-title {
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }
        .nav-link {
            display: block;
            padding: 0.5rem 0;
            color: var(--text);
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.2s;
        }
        .nav-link:hover { color: var(--primary); }
        .nav-link.active { color: var(--primary); font-weight: 600; }

        .content-wrapper {
            margin-left: 300px;
            flex: 1;
            padding: 4rem;
            max-width: 1000px;
        }
        .markdown-body { line-height: 1.7; }
        .markdown-body h1 { font-family: 'Montserrat', sans-serif; margin-bottom: 2rem; color: var(--primary); }
        .markdown-body pre { background: #1e293b; padding: 1rem; border-radius: 8px; overflow-x: auto; border: 1px solid var(--border); }
        .markdown-body code { font-family: 'ui-monospace', monospace; background: rgba(255,255,255,0.1); padding: 0.2rem 0.4rem; border-radius: 4px; }
        
        .version-selector {
            margin-top: auto;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }
        select {
            background: #1e293b;
            color: var(--text);
            border: 1px solid var(--border);
            padding: 0.5rem;
            border-radius: 4px;
            width: 100%;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="/" class="logo">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="16" cy="16" r="14" stroke="currentColor" stroke-width="3"/>
                <path d="M16 8V24M8 16H24" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            </svg>
            OpenTrusty
        </a>
        
        <nav>
            
            <div class="nav-section">
                <div class="nav-title">Architecture</div>
                <a href="architecture_architecture-rules.html" class="nav-link ">Architecture Rules</a><a href="architecture_domain-model.html" class="nav-link ">Domain Model</a><a href="architecture_runtime-assumptions.html" class="nav-link ">Runtime Assumptions</a><a href="architecture_docs-publication.html" class="nav-link ">Docs Publication</a>
            </div>
        
            <div class="nav-section">
                <div class="nav-title">Protocols</div>
                <a href="domain_identity-model.html" class="nav-link ">Identity Model</a><a href="architecture_protocol-boundary.html" class="nav-link ">Protocol Boundary</a><a href="architecture_protocol-error-model.html" class="nav-link ">Error Model</a>
            </div>
        
            <div class="nav-section">
                <div class="nav-title">Security</div>
                <a href="security_threat-model.html" class="nav-link ">Threat Model</a><a href="security_security-assumptions.html" class="nav-link ">Security Assumptions</a>
            </div>
        
            <div class="nav-section">
                <div class="nav-title">Deployment</div>
                <a href="fundamentals_deployment-philosophy.html" class="nav-link ">Deployment Philosophy</a><a href="fundamentals_storage-model.html" class="nav-link ">Storage Model</a><a href="deployment_OPERATIONS.html" class="nav-link ">Operations Guide</a><a href="operations_bootstrap.html" class="nav-link ">Operations Manual</a><a href="deploy_systemd_README.html" class="nav-link ">Systemd Guide</a>
            </div>
        
            <div class="nav-section">
                <div class="nav-title">Roadmap</div>
                <a href="roadmap_evolution-roadmap.html" class="nav-link ">Evolution Roadmap</a><a href="roadmap_tech-debt-strategy.html" class="nav-link active">Tech Debt Strategy</a>
            </div>
        
            <div class="nav-section">
                <div class="nav-title">API</div>
                <a href="api/index.html" class="nav-link ">Interactive Reference</a>
            </div>
        
        </nav>

        <div class="version-selector">
            <div class="nav-title">Version</div>
            <select id="v-select" onchange="window.location.href=this.value">
                <option value="/versions/v0.1.0_alpha1/" >v0.1.0_alpha1</option><option value="/versions/v0.1.0_alpha2/" >v0.1.0_alpha2</option><option value="/versions/v0.1.0_alpha3/" >v0.1.0_alpha3</option><option value="/versions/v0.1.0_alpha4/" selected>v0.1.0_alpha4</option>
            </select>
        </div>
    </div>

    <main class="content-wrapper">
        <div id="content" class="markdown-body">
            
        </div>
    </main>

    <script>
        // Simple markdown injection if content is raw
        const rawContent = `# Tech Debt Strategy

This document classifies identified architectural issues and technical debt based on the critical path of the [Evolution Roadmap](evolution-roadmap.md).

## 1. Must Fix BEFORE OAuth2/OIDC (Phase 1)
*Issues that compromise the security or correctness of the core protocol implementation.*

### 1.1. Explicit Tenant Context in Transport
- **Issue**: \`getTenantID\` defaults to \`"default"\` if header is missing.
- **Why it must be fixed**: While acceptable for single-tenant, it violates "Secure by Design". A security protocol should never rely on implicit magic strings. If we are hardening security in Phase 1, we must ensure every request is explicitly scoped, even if only one tenant exists. Implicit defaults mask configuration errors.
- **Remediation**: Remove default. Return \`400 Bad Request\` if context is missing.

---

## 2. Must Fix BEFORE Multi-Tenancy (Phase 2)
*Issues that effectively break isolation or management in a multi-tenant environment.*

### 2.1. Tenant Context in Access Token Validation
- **Issue**: \`UserInfo\` endpoint retrieves Tenant ID from the *User* entity, not the *Access Token*.
- **Why it must be fixed**: In complex multi-tenancy, a user might eventually exist in multiple contexts (or federation). Relying on the User's "home" tenant instead of the "token's" tenant context creates ambiguity.
- **Remediation**: snapshot \`TenantID\` into the Access Token claims/table at issuance time.

---

## 3. Can Be Postponed Safely (Phases 3 & 4)
*Issues that limit flexibility but do not compromise current security or functionality.*

### 3.1. Identity ↔ Password Coupling
- **Issue**: \`CreateUser\` requires a password argument.
- **Postponed Until**: **Phase 3 (Federation)**.
- **Reasoning**: Phase 1 & 2 rely on standard username/password (plus MFA). We do not need passwordless users until we import users from external IdPs (Federation) or implement pure Passkeys.

### 3.2. OIDC Protocol ↔ Internal Role Storage
- **Issue**: \`GenerateIDToken\` directly queries \`tenantRoleRepo\`.
- **Postponed Until**: **Phase 3 (Enterprise Integration)**.
- **Reasoning**: As long as OpenTrusty is the sole source of roles (RBAC), this coupling is efficient and harmless. Abstraction is only needed when roles come from LDAP/SCIM.

### 3.3. Session ↔ Cookie Coupling
- **Issue**: Login handler only sets cookies, doesn't return Session ID in JSON.
- **Postponed Until**: **Phase 4 (Developer Experience / CLI)**.
- **Reasoning**: Browsers (primary target for Phase 1-3) handle cookies natively. CLI/Mobile support is a later concern.

---

## 4. Never Fix (Intentional Constraints)
*"Fake" issues that are actually design choices.*

### 4.1. Stateful Sessions (No JWT)
- **Observation**: Primary sessions require a DB lookup.
- **Decision**: **Keep as is.**
- **Reasoning**: Immediate revocation is a core security requirement (Rule 5.1). Stateless JWT sessions prevent this.

### 4.2. Lack of "Magic Link" / Proprietary Login APIs
- **Observation**: Login is strict OAuth2 or Basic Auth.
- **Decision**: **Keep as is.**
- **Reasoning**: Adherence to RFC specs (Rule 3.1) prevents vendor lock-in and security drift.
`;
        if (rawContent && rawContent.length > 0) {
            document.getElementById('content').innerHTML = marked.parse(rawContent);
        }
    </script>
</body>
</html>
